# æª”æ¡ˆåç¨±ï¼š.github/workflows/docker-build.yml

name: Docker Image CI # å·¥ä½œæµçš„åç¨±

# è§¸ç™¼æ¢ä»¶ï¼šç•¶ç¨‹å¼ç¢¼è¢«æ¨é€åˆ° 'main' åˆ†æ”¯æ™‚
on:
  push:
    branches: [ "main" ]

# å®šç¾©ä¸€å€‹ Job (ä»»å‹™)
jobs:
  build_and_push:
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™›æ“¬æ©Ÿä¾†åŸ·è¡Œé€™å€‹ä»»å‹™

    steps:
    - name: Checkout Code # æ­¥é©Ÿ 1: æª¢æŸ¥ç¨‹å¼ç¢¼
      # ç²å–æ‚¨çš„ GitHub å€‰åº«çš„ç¨‹å¼ç¢¼åˆ°è™›æ“¬æ©Ÿä¸­
      uses: actions/checkout@v4

    - name: Log in to Docker Hub # æ­¥é©Ÿ 2: ç™»å…¥ Docker Hub
      # è®“ GitHub å¯ä»¥å°‡æ§‹å»ºå¥½çš„æ˜ åƒæª”æ¨é€åˆ°æ‚¨çš„ Docker å¸³æˆ¶
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }} # ç¨å¾Œè¨­å®š
        password: ${{ secrets.DOCKER_PASSWORD }} # ç¨å¾Œè¨­å®š

    - name: Build and Push Docker Image
      uses: docker/build-push-action@v5
      with:
        context: .
        push: true
        # ğŸš¨ ä¿®æ­£ï¼šç§»é™¤ä¸­æ–‡èˆ‡ç‰¹æ®Šæ‹¬è™Ÿï¼Œè«‹ç¢ºä¿åç¨±åªåŒ…å«å°å¯«è‹±æ–‡å­—æ¯ã€æ•¸å­—ã€åº•ç·šæˆ–é€£å­—è™Ÿ
        tags: ${{ secrets.DOCKER_USERNAME }}/my-discord-bot:latest 


    - name: Build Succeeded Message # æ­¥é©Ÿ 4: æ§‹å»ºæˆåŠŸæç¤º (å¯é¸)
      run: echo "Docker æ˜ åƒæª”å·²æˆåŠŸæ§‹å»ºä¸¦æ¨é€åˆ° Docker Hubï¼"